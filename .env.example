# FastAPI Monitoring Configuration
# Copy this file to .env and fill in your values

# ======================
# Core Settings
# ======================

# Enable or disable monitoring system
MONITORING_ENABLED=true

# Environment name (appears in Telegram alerts)
# Options: development, staging, production
MONITORING_ENV=development

# ======================
# Telegram Settings
# ======================

# Telegram Bot Token (get from @BotFather)
# SECURITY: Keep this secret! Never commit to Git!
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Telegram Chat/Channel ID (where to send alerts)
# Use @userinfobot to get your chat ID
# TIP: Use private groups for production alerts
TELEGRAM_CHAT_ID=-1001234567890

# Optional: Thread ID for topic-based groups
# TELEGRAM_THREAD_ID=123

# ======================
# Alert Settings
# ======================

# Minimum minutes between duplicate error alerts
MONITORING_ALERT_RATE_LIMIT_MINUTES=10

# Maximum lines of traceback to include in error alerts
# SECURITY: Lower this to reduce sensitive data exposure
# Set to 0 to disable tracebacks entirely
MONITORING_ALERT_MAX_TRACEBACK_LINES=15

# Maximum Telegram message length (don't change unless needed)
MONITORING_ALERT_MAX_MESSAGE_LENGTH=4000

# Send alerts asynchronously without blocking request responses
# Set to false only for debugging/testing
# PRODUCTION: Keep this enabled for performance
MONITORING_ALERT_FIRE_AND_FORGET=true

# ======================
# Health Check Settings
# ======================

# How often to run health checks (minutes)
MONITORING_HEALTH_CHECK_INTERVAL_MINUTES=30

# Database query timeout for health checks (seconds)
MONITORING_HEALTH_DB_TIMEOUT_SECONDS=5

# Redis ping timeout for health checks (seconds)
MONITORING_HEALTH_REDIS_TIMEOUT_SECONDS=3

# Minutes before queue considered stuck
MONITORING_HEALTH_QUEUE_STUCK_MINUTES=10

# ======================
# Daily Reports
# ======================

# Enable daily statistics reports
MONITORING_DAILY_REPORT_ENABLED=true

# Hour to send daily report (0-23, UTC)
MONITORING_DAILY_REPORT_HOUR=9

# Minute to send daily report (0-59)
MONITORING_DAILY_REPORT_MINUTE=0

# ======================
# Exception Monitoring
# ======================

# Monitor and report exceptions
MONITORING_MONITOR_EXCEPTIONS=true

# Comma-separated list of exception types to ignore
# MONITORING_IGNORED_EXCEPTIONS=HTTPException,RequestValidationError

# Comma-separated list of URL paths to ignore
# SECURITY: Add sensitive endpoints here!
# Example: /auth/login,/payment/process,/admin
# MONITORING_IGNORED_PATHS=/health,/metrics,/static,/docs,/redoc,/openapi.json

# ======================
# Performance Monitoring
# ======================

# Monitor slow requests
MONITORING_MONITOR_SLOW_REQUESTS=true

# Threshold for slow request alerts (seconds)
MONITORING_SLOW_REQUEST_THRESHOLD_SECONDS=3.0

# Batch slow request alerts for this many minutes
MONITORING_SLOW_REQUESTS_BATCH_MINUTES=15

# ======================
# Background Task Monitoring (ARQ)
# ======================

# Monitor ARQ background tasks
MONITORING_MONITOR_ARQ_TASKS=true

# Send alerts on task failures
MONITORING_ARQ_TASK_FAILURE_ALERT=true

# Threshold for slow background task alerts (seconds)
MONITORING_ARQ_TASK_SLOW_THRESHOLD_SECONDS=60.0

# Comma-separated list of task names to ignore
# MONITORING_ARQ_IGNORED_TASKS=mark_job_completed

# ======================
# Batch Alert Settings
# ======================

# Time window for batching non-critical alerts (minutes)
MONITORING_BATCH_WINDOW_MINUTES=15

# Maximum alerts in one batch message
MONITORING_BATCH_MAX_ALERTS=10

# ======================
# Redis Configuration
# ======================

# Prefix for monitoring Redis keys
MONITORING_REDIS_KEY_PREFIX=monitoring

# TTL for monitoring data in Redis (hours)
MONITORING_REDIS_KEY_TTL_HOURS=24

# ======================
# Production Checklist
# ======================

# ✅ Redis configured and connected (required for multi-worker!)
# ✅ TELEGRAM_BOT_TOKEN kept secret
# ✅ Private Telegram group/channel used
# ✅ IGNORED_PATHS configured for sensitive endpoints
# ✅ ALERT_MAX_TRACEBACK_LINES reviewed (consider reducing)
# ✅ MONITORING_ENV set to "production"
# ✅ ALERT_FIRE_AND_FORGET=true (for performance)
# ✅ Rate limits configured appropriately
# ✅ Health checks tested
# ✅ Daily reports tested

# ======================
# Development Tips
# ======================

# For local development without Redis:
# - Single worker only (no Uvicorn workers)
# - Deduplication works locally only
# - Statistics may be inaccurate

# For testing alerts:
# - Set MONITORING_ENV=development
# - Use separate test bot/channel
# - Set ALERT_RATE_LIMIT_MINUTES=1 for faster testing
# - Set ALERT_FIRE_AND_FORGET=false to see immediate results

# For sensitive applications:
# - Review all traceback content
# - Use IGNORED_PATHS liberally
# - Consider ALERT_MAX_TRACEBACK_LINES=0
# - Implement custom exception handlers for sensitive routes